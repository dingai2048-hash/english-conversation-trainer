# 自动静音检测功能

## 功能概述

新增了**自动静音检测（Auto Silence Detection）**功能，让语音输入更加自然流畅。

### 工作原理

1. **点击一次麦克风** - 开始录音
2. **正常说话** - 系统持续识别你的语音
3. **保持安静 2 秒** - 系统自动检测到静音
4. **自动提交** - 无需手动点击，自动停止录音并处理

## 使用体验

### 之前的方式 ❌
```
1. 点击麦克风开始
2. 说话
3. 点击麦克风停止  ← 需要手动操作
4. 等待处理
```

### 现在的方式 ✅
```
1. 点击麦克风开始
2. 说话
3. 停止说话，保持安静
4. 2秒后自动提交  ← 无需手动操作！
```

## 技术实现

### SpeechRecognitionService 增强

新增了以下功能：

1. **静音计时器**
   - 检测用户停止说话的时间
   - 默认 2 秒静音后触发自动停止

2. **语音活动检测**
   - 实时监测语音识别结果
   - 每次检测到新的语音内容时重置计时器

3. **自动停止回调**
   - 当检测到足够长的静音时触发
   - 自动调用停止录音流程

### 新增 API

```typescript
// 设置自动停止回调
speechService.onAutoStop(() => {
  // 自动停止时的处理逻辑
});

// 设置静音延迟时间（毫秒）
speechService.setSilenceDelay(2000); // 默认 2 秒

// 获取当前静音延迟时间
const delay = speechService.getSilenceDelay();
```

## 配置选项

### 调整静音延迟时间

如果你觉得 2 秒太短或太长，可以在代码中调整：

```typescript
// 在 App.tsx 的 handleToggleRecording 中
speechService.setSilenceDelay(3000); // 改为 3 秒
```

推荐设置：
- **快速对话**: 1.5 - 2 秒
- **正常对话**: 2 - 2.5 秒
- **思考时间较长**: 3 - 4 秒

## 用户界面提示

### 桌面端
- 录音时显示：**"🎤 正在录音... (2秒静音后自动提交)"**
- 提示文字：**"说完后保持安静，系统会自动提交"**

### 移动端
- 录音时显示：**"🎤 正在录音... (2秒静音后自动提交)"**

## 与连续对话模式的配合

自动静音检测与连续对话模式完美配合：

1. **开启连续模式**
2. **点击麦克风开始第一轮对话**
3. **说话 → 自动检测静音 → 自动提交**
4. **AI 回复 → 自动开始下一轮录音**
5. **继续说话 → 自动检测静音 → 自动提交**
6. **循环往复，无需手动操作**

## 注意事项

### 环境要求
- 需要相对安静的环境
- 避免持续的背景噪音
- 麦克风质量会影响检测效果

### 最佳实践
1. **说完整句子后停顿** - 让系统有时间检测静音
2. **避免频繁停顿** - 说话时的短暂停顿不会触发自动停止
3. **环境噪音** - 如果环境嘈杂，可能需要手动点击停止

### 手动控制
如果不想等待自动停止，仍然可以：
- **随时点击麦克风按钮手动停止录音**
- 手动停止会立即处理，不会等待静音检测

## 技术细节

### 静音检测逻辑

```typescript
// 每次检测到语音活动时
if (hasFinalResult || hasInterimResult) {
  lastSpeechTime = Date.now();
  resetSilenceTimer(); // 重置 2 秒计时器
}

// 2 秒后检查
setTimeout(() => {
  const timeSinceLastSpeech = Date.now() - lastSpeechTime;
  if (timeSinceLastSpeech >= 2000 && hasRecognizedText) {
    autoStop(); // 触发自动停止
  }
}, 2000);
```

### 防止误触发

系统会检查：
1. ✅ 是否真的静音了足够长时间
2. ✅ 是否已经识别到了一些文字
3. ✅ 避免在刚开始录音时就触发

## 故障排除

### 问题：自动停止太快
**解决方案**：增加静音延迟时间
```typescript
speechService.setSilenceDelay(3000); // 改为 3 秒
```

### 问题：自动停止太慢
**解决方案**：减少静音延迟时间
```typescript
speechService.setSilenceDelay(1500); // 改为 1.5 秒
```

### 问题：在说话时就自动停止了
**原因**：可能是环境噪音或麦克风问题
**解决方案**：
1. 检查麦克风是否正常工作
2. 减少背景噪音
3. 使用更好的麦克风

### 问题：一直不自动停止
**原因**：可能是持续的背景噪音被识别为语音
**解决方案**：
1. 手动点击麦克风停止
2. 改善录音环境
3. 调整麦克风灵敏度

## 未来改进方向

1. **可配置的静音时间** - 在设置面板中添加滑块调整
2. **音量可视化** - 显示实时音量波形
3. **智能静音检测** - 根据说话速度自动调整延迟
4. **语音活动指示器** - 更直观的视觉反馈

## 反馈

如果你有任何建议或遇到问题，欢迎反馈！
