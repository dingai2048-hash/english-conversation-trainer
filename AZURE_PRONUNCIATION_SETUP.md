# Azure 发音评估设置指南

本指南将帮助你配置 Azure Speech Services 来实现智能发音评估功能。

## 📋 目录

1. [功能介绍](#功能介绍)
2. [获取 Azure API Key](#获取-azure-api-key)
3. [配置应用](#配置应用)
4. [智能评估策略](#智能评估策略)
5. [费用说明](#费用说明)
6. [常见问题](#常见问题)

---

## 🎯 功能介绍

Azure 发音评估功能可以：

- **自动评估发音**：AI 会在适当时候自动评估你的发音质量
- **智能纠正**：当发音有问题时，AI 会在对话中自然地纠正你
- **完全无感知**：评估过程在后台进行，不影响对话流畅度
- **节省费用**：使用混合策略，仅在必要时评估，节省 75-80% 费用

### 评估内容

- **准确度** (Accuracy)：单词发音的准确性
- **流利度** (Fluency)：说话的流畅程度
- **完整度** (Completeness)：是否说完整了句子
- **发音分数** (Pronunciation Score)：综合评分 (0-100)

---

## 🔑 获取 Azure API Key

### 步骤 1: 创建 Azure 账号

1. 访问 [Azure Portal](https://portal.azure.com)
2. 如果没有账号，点击 "Start free" 创建免费账号
3. 新用户可获得 $200 免费额度（30天有效）

### 步骤 2: 创建 Speech Services 资源

1. 登录 Azure Portal
2. 点击左上角 "Create a resource"
3. 搜索 "Speech Services"
4. 点击 "Create"

### 步骤 3: 配置资源

填写以下信息：

- **Subscription**: 选择你的订阅
- **Resource Group**: 创建新的或选择现有的
- **Region**: 选择离你最近的区域（推荐：East Asia 或 Southeast Asia）
- **Name**: 给资源起个名字（例如：my-speech-service）
- **Pricing Tier**: 选择 "Free F0" 或 "Standard S0"

点击 "Review + create"，然后点击 "Create"。

### 步骤 4: 获取 API Key

1. 资源创建完成后，进入资源页面
2. 在左侧菜单找到 "Keys and Endpoint"
3. 复制 **Key 1** 或 **Key 2**（任选其一）
4. 记下 **Region**（例如：eastus, eastasia）

---

## ⚙️ 配置应用

### 在应用中配置

1. 打开应用，点击右上角 **"设置"** 按钮
2. 滚动到 **"🎯 发音评估设置"** 部分
3. 打开 **"启用发音评估"** 开关
4. 填写以下信息：
   - **Azure Speech API Key**: 粘贴你复制的 Key
   - **Azure 区域**: 选择你创建资源时的区域
   - **你的英语水平**: 选择你的水平（初学者/中级/高级）
5. 点击 **"保存设置"**

### 配置说明

#### 英语水平选择

- **初学者 (Beginner)**: 评估频率约 30%，更多反馈
- **中级 (Intermediate)**: 评估频率约 20%，适度反馈
- **高级 (Advanced)**: 评估频率约 10%，最少反馈

水平越高，评估越少，费用越低。

---

## 🧠 智能评估策略

我们使用混合策略来决定何时进行发音评估，既保证效果又节省费用。

### 强制评估（必定触发）

以下情况会强制进行评估：

1. **低置信度**: 语音识别置信度 < 70%
2. **关键错误**: 识别文本太短（< 3 字符）或包含 "???"
3. **定期检查**: 每 5 条消息进行一次评估

### 条件评估（概率触发）

以下情况会有一定概率触发评估：

1. **时间间隔**: 距离上次评估超过 60 秒，50% 概率评估
2. **困难发音**: 包含困难音素（th, r, l, v, w, sh, ch），40% 概率评估
3. **基础随机**: 根据用户水平随机评估
   - 初学者: 30% 概率
   - 中级: 20% 概率
   - 高级: 10% 概率

### 预期评估率

综合以上策略，实际评估率约为 **20-25%**，相比 100% 评估节省 **75-80%** 费用。

### 用户体验

- ✅ **完全无感知**: 评估在后台进行，不会打断对话
- ✅ **自然纠正**: AI 会在回复中自然地纠正发音问题
- ✅ **不影响流畅度**: 评估失败不会影响对话继续
- ✅ **智能触发**: 只在真正需要时才评估

---

## 💰 费用说明

### Azure Speech Services 定价

- **免费层 (F0)**:
  - 每月 5 小时免费语音识别
  - 适合个人学习使用
  
- **标准层 (S0)**:
  - $1.00 / 1000 次评估
  - 按实际使用量计费

### 费用估算

假设每天练习 30 分钟，每次对话 10 秒：

- **每天消息数**: 约 180 条（30分钟 ÷ 10秒）
- **每月消息数**: 约 5,400 条（180 × 30天）
- **评估次数**: 约 1,080 次（5,400 × 20%）
- **月费用**: 约 **$1.08**

使用智能策略 vs 100% 评估：

| 策略 | 评估率 | 月评估次数 | 月费用 |
|------|--------|-----------|--------|
| 100% 评估 | 100% | 5,400 | $5.40 |
| 智能策略 | 20% | 1,080 | $1.08 |
| **节省** | **-80%** | **-4,320** | **-$4.32** |

### 免费层使用建议

如果使用免费层（每月 5 小时）：

- 5 小时 = 300 分钟 = 1,800 次评估（每次10秒）
- 使用智能策略，可支持约 **9,000 条消息**
- 相当于每天练习 **50 分钟**，完全够用！

---

## ❓ 常见问题

### Q1: 我必须使用 Azure 吗？

不是必须的。发音评估是可选功能，你可以：

- 不启用发音评估，仅使用语音识别和 AI 对话
- 启用后，AI 会自动纠正发音和语法错误

### Q2: 评估会影响对话流畅度吗？

不会。评估过程：

1. 在后台异步进行
2. 失败不会影响对话继续
3. 用户完全无感知
4. 只有需要纠正时，AI 才会在回复中提及

### Q3: 如何知道评估是否在工作？

你可以：

1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签
3. 看到 `[Assessment]` 开头的日志表示评估正在工作
4. 看到 `[Pronunciation]` 日志表示评估结果

### Q4: 评估不准确怎么办？

可能的原因：

1. **麦克风质量差**: 使用更好的麦克风
2. **环境噪音**: 在安静环境录音
3. **说话太快**: 放慢语速，清晰发音
4. **区域选择错误**: 确保选择正确的 Azure 区域

### Q5: 如何查看评估统计？

目前统计信息在控制台中显示。未来版本会在设置页面添加统计面板，显示：

- 总消息数
- 评估次数
- 评估率
- 预估费用

### Q6: 可以调整评估策略吗？

当前版本使用预设的混合策略。如果你需要自定义策略（例如更高或更低的评估率），可以：

1. 修改 `SmartPronunciationService.ts` 中的 `DEFAULT_STRATEGY` 配置
2. 或者联系开发者添加自定义配置选项

### Q7: 免费额度用完了怎么办？

如果免费层用完：

1. 升级到标准层（按使用量付费）
2. 或者暂时禁用发音评估功能
3. 下个月免费额度会重置

---

## 🎓 最佳实践

### 1. 选择合适的水平

- 刚开始学习：选择 "初学者"，获得更多反馈
- 有一定基础：选择 "中级"，平衡反馈和费用
- 发音较好：选择 "高级"，减少不必要的评估

### 2. 优化录音质量

- 使用质量好的麦克风
- 在安静的环境录音
- 说话清晰，不要太快
- 保持麦克风距离适中

### 3. 关注 AI 反馈

当 AI 在回复中提到发音时，例如：

> "Good try! We say 'think' more clearly. Try it!"

这表示评估检测到了发音问题，要特别注意这个词的发音。

### 4. 定期检查统计

打开浏览器控制台，查看评估统计：

```
[Assessment] Stats: { totalMessages: 100, assessmentCount: 22, assessmentRate: 0.22 }
```

确保评估率在 20-25% 左右。

---

## 🔧 故障排除

### 问题：评估从不触发

**可能原因**：

1. 未启用发音评估功能
2. Azure API Key 或 Region 配置错误
3. 网络问题

**解决方法**：

1. 检查设置中是否启用了发音评估
2. 验证 API Key 和 Region 是否正确
3. 打开控制台查看错误信息
4. 测试网络连接到 Azure

### 问题：评估总是失败

**可能原因**：

1. API Key 无效或过期
2. 免费额度用完
3. 区域选择错误
4. 音频格式不支持

**解决方法**：

1. 重新生成 API Key
2. 检查 Azure 账单和额度
3. 尝试更换区域
4. 确保使用 Chrome 或 Edge 浏览器

### 问题：费用超出预期

**可能原因**：

1. 评估率过高
2. 练习时间过长
3. 使用了标准层而非免费层

**解决方法**：

1. 检查控制台中的评估统计
2. 调整用户水平到更高级别
3. 考虑使用免费层
4. 减少每天练习时间

---

## 📞 获取帮助

如果遇到问题：

1. 查看浏览器控制台的错误信息
2. 检查 Azure Portal 中的资源状态
3. 参考 [Azure Speech Services 文档](https://docs.microsoft.com/azure/cognitive-services/speech-service/)
4. 提交 Issue 到项目 GitHub 仓库

---

## 🎉 开始使用

现在你已经了解了如何配置和使用 Azure 发音评估功能！

1. ✅ 获取 Azure API Key
2. ✅ 在应用中配置
3. ✅ 选择合适的英语水平
4. ✅ 开始练习对话

AI 会在适当的时候自动评估你的发音，并在对话中自然地纠正你。祝你学习愉快！🚀
