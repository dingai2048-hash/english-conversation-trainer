# 🎤 录音交互需求 - Fluently 风格

## 📱 参考：GetFluently.app 的交互方式

### 核心特点

1. **按住说话（Push-to-Talk）**
   - 按住按钮开始录音
   - 松开按钮停止录音
   - 类似微信语音消息
   - 简单直观

2. **即时反馈**
   - 按住时立即开始录音
   - 松开时立即停止
   - 无需等待静音检测
   - 用户完全控制

3. **流畅对话**
   - AI 回复后自动准备下一轮
   - 无需点击"开始对话"
   - 持续对话状态
   - 随时可以说话

## 🎯 理想的交互流程

### 方案 A：按住说话（推荐）⭐⭐⭐⭐⭐

```
进入页面
    ↓
显示大按钮："按住说话"
    ↓
用户按住按钮
    ↓
立即开始录音 🎤
    ↓
用户说话
    ↓
用户松开按钮
    ↓
立即停止录音并提交
    ↓
Whisper 识别
    ↓
AI 生成回复
    ↓
TTS 播放 🔊
    ↓
回到"按住说话"状态
    ↓
用户可以继续按住说话
```

**优点**：
- ✅ 用户完全控制录音时长
- ✅ 无需等待静音检测
- ✅ 不会误触发
- ✅ 不会录到系统音频
- ✅ 交互简单直观
- ✅ 类似微信，用户熟悉

**缺点**：
- ❌ 需要一直按住（移动端更自然）
- ❌ 桌面端可能不太方便

### 方案 B：点击切换 + 手动停止

```
进入页面
    ↓
显示按钮："开始录音"
    ↓
用户点击按钮
    ↓
开始录音 🎤
    ↓
按钮变为"停止录音"
    ↓
用户说话
    ↓
用户点击"停止录音"
    ↓
停止录音并提交
    ↓
AI 回复 + TTS 🔊
    ↓
回到"开始录音"状态
```

**优点**：
- ✅ 不需要一直按住
- ✅ 桌面端更方便
- ✅ 用户控制录音时长
- ✅ 不会误触发

**缺点**：
- ❌ 需要点击两次（开始+停止）
- ❌ 可能忘记停止

### 方案 C：点击开始 + 自动静音检测

```
进入页面
    ↓
显示按钮："开始录音"
    ↓
用户点击按钮
    ↓
开始录音 🎤
    ↓
用户说话
    ↓
停顿 0.8 秒
    ↓
自动停止录音
    ↓
AI 回复 + TTS 🔊
    ↓
自动开始下一轮录音
```

**优点**：
- ✅ 只需点击一次
- ✅ 自动检测静音
- ✅ 流畅对话

**缺点**：
- ❌ 可能误触发（环境噪音）
- ❌ 可能录到系统音频
- ❌ 需要耳机
- ❌ 用户失去控制感

## 💡 推荐方案：混合模式

### 桌面端：点击切换 + 手动停止

**为什么**：
- 桌面端有鼠标，点击方便
- 不需要一直按住
- 更适合长时间对话

**交互**：
1. 点击"开始录音"按钮
2. 按钮变红，显示"正在录音..."
3. 说话
4. 点击"停止录音"按钮
5. AI 回复
6. 重复 1-5

### 移动端：按住说话

**为什么**：
- 移动端触摸屏，按住更自然
- 类似微信语音
- 用户熟悉这种交互

**交互**：
1. 按住"按住说话"按钮
2. 说话
3. 松开按钮
4. AI 回复
5. 重复 1-4

## 🎨 UI 设计

### 桌面端

**初始状态**：
```
┌─────────────────────┐
│                     │
│    🐨 Koala        │
│                     │
│   ┌───────────┐    │
│   │ 开始录音  │    │
│   └───────────┘    │
│                     │
│  点击按钮开始说话   │
└─────────────────────┘
```

**录音状态**：
```
┌─────────────────────┐
│                     │
│    🐨 Koala        │
│   (listening)       │
│   ┌───────────┐    │
│   │ 停止录音  │    │ ← 红色
│   └───────────┘    │
│                     │
│  🎤 正在录音...     │
│  点击按钮停止       │
└─────────────────────┘
```

**AI 回复状态**：
```
┌─────────────────────┐
│                     │
│    🐨 Koala        │
│   (speaking)        │
│   ┌───────────┐    │
│   │ 等待中... │    │ ← 灰色禁用
│   └───────────┘    │
│                     │
│  🗣️ 考拉正在说话... │
└─────────────────────┘
```

### 移动端

**初始状态**：
```
┌─────────────┐
│             │
│  🐨 Koala  │
│             │
│ ┌─────────┐│
│ │按住说话 ││
│ └─────────┘│
│             │
│ 按住按钮说话│
└─────────────┘
```

**录音状态**（按住时）：
```
┌─────────────┐
│             │
│  🐨 Koala  │
│ (listening) │
│ ┌─────────┐│
│ │正在录音 ││ ← 红色
│ └─────────┘│
│             │
│ 🎤 松开停止 │
└─────────────┘
```

## 🔧 技术实现

### 桌面端：点击切换

```typescript
const [isRecording, setIsRecording] = useState(false);

const handleToggleRecording = async () => {
  if (isRecording) {
    // 停止录音
    setIsRecording(false);
    const text = await sttService.stopRecording();
    // 处理识别结果...
  } else {
    // 开始录音
    await sttService.startRecording();
    setIsRecording(true);
  }
};

// UI
<button onClick={handleToggleRecording}>
  {isRecording ? '停止录音' : '开始录音'}
</button>
```

### 移动端：按住说话

```typescript
const handleMouseDown = async () => {
  // 开始录音
  await sttService.startRecording();
  setIsRecording(true);
};

const handleMouseUp = async () => {
  // 停止录音
  setIsRecording(false);
  const text = await sttService.stopRecording();
  // 处理识别结果...
};

// UI
<button 
  onMouseDown={handleMouseDown}
  onMouseUp={handleMouseUp}
  onTouchStart={handleMouseDown}
  onTouchEnd={handleMouseUp}
>
  按住说话
</button>
```

## 🎯 关键改进点

### 1. 移除自动静音检测

**为什么**：
- ❌ 容易误触发
- ❌ 可能录到系统音频
- ❌ 需要耳机
- ❌ 用户失去控制感

**改为**：
- ✅ 用户手动控制
- ✅ 不会误触发
- ✅ 不需要耳机
- ✅ 更可靠

### 2. 移除自动录音循环

**为什么**：
- ❌ AI 说完后自动录音可能录到残留声音
- ❌ 用户可能还没准备好
- ❌ 容易形成无限循环

**改为**：
- ✅ AI 说完后等待用户操作
- ✅ 用户决定何时继续
- ✅ 更可控

### 3. 简化会话流程

**移除**：
- ❌ "开始对话"按钮
- ❌ "结束对话"按钮
- ❌ 会话状态管理

**改为**：
- ✅ 进入页面就可以说话
- ✅ 随时可以录音
- ✅ 无需管理状态

## 📋 实现清单

### Phase 1：基础功能

- [ ] 移除自动静音检测
- [ ] 移除自动录音循环
- [ ] 移除会话状态管理
- [ ] 实现点击切换录音（桌面端）
- [ ] 实现按住说话（移动端）
- [ ] 更新 UI 设计

### Phase 2：优化体验

- [ ] 添加录音动画
- [ ] 添加音量指示器
- [ ] 优化按钮样式
- [ ] 添加触觉反馈（移动端）
- [ ] 优化 TTS 播放

### Phase 3：高级功能

- [ ] 添加录音时长显示
- [ ] 添加最大录音时长限制
- [ ] 添加录音取消功能
- [ ] 添加录音预览功能

## 🤔 需要确认的问题

### 1. 桌面端交互方式

**选项 A**：点击切换（推荐）
- 点击"开始录音" → 录音 → 点击"停止录音"
- 优点：不需要一直按住
- 缺点：需要点击两次

**选项 B**：按住说话
- 按住按钮 → 录音 → 松开按钮
- 优点：只需一个动作
- 缺点：需要一直按住

**你的选择**：？

### 2. 移动端交互方式

**选项 A**：按住说话（推荐）
- 按住按钮 → 录音 → 松开按钮
- 优点：类似微信，用户熟悉
- 缺点：需要一直按住

**选项 B**：点击切换
- 点击"开始录音" → 录音 → 点击"停止录音"
- 优点：不需要一直按住
- 缺点：需要点击两次

**你的选择**：？

### 3. 是否需要会话管理

**选项 A**：无会话管理（推荐）
- 进入页面就可以说话
- 随时可以录音
- 简单直接

**选项 B**：有会话管理
- 需要点击"开始对话"
- 需要点击"结束对话"
- 可以保存历史记录

**你的选择**：？

### 4. AI 说完后的行为

**选项 A**：等待用户操作（推荐）
- AI 说完后显示"开始录音"按钮
- 用户决定何时继续
- 不会误触发

**选项 B**：自动开始录音
- AI 说完后自动开始录音
- 流畅对话
- 可能误触发

**你的选择**：？

## 📝 总结

### 推荐方案

**桌面端**：
- 点击切换录音
- 点击"开始录音" → 说话 → 点击"停止录音"
- AI 回复后等待用户操作

**移动端**：
- 按住说话
- 按住按钮 → 说话 → 松开按钮
- AI 回复后等待用户操作

**共同点**：
- 移除自动静音检测
- 移除自动录音循环
- 用户完全控制
- 简单可靠

### 下一步

请告诉我：
1. 你更喜欢哪种交互方式？
2. 是否需要会话管理？
3. AI 说完后应该怎么做？

我会根据你的选择来实现！
