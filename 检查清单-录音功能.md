# ✅ 录音功能检查清单

## 🌐 网站状态

### 开发服务器
- ✅ **状态**: 正常运行
- ✅ **编译**: 成功（有一些警告但不影响功能）
- ✅ **地址**: http://localhost:3000

### 访问网站
1. 打开浏览器
2. 访问 http://localhost:3000
3. **强制刷新**: `Cmd + Shift + R` (macOS)

## 🎤 录音功能检查步骤

### 第 1 步：检查页面加载

**操作**：
- 打开 http://localhost:3000
- 强制刷新 (Cmd + Shift + R)

**预期结果**：
- ✅ 页面正常显示
- ✅ 看到考拉图片/视频
- ✅ 看到"英语对话训练"标题
- ✅ 看到蓝色麦克风按钮
- ✅ 显示"点击开始新对话"

### 第 2 步：开始会话

**操作**：
- 点击蓝色麦克风按钮

**预期结果**：
- ✅ 进入会话模式
- ✅ 看到两个按钮：
  - 🟢 绿色按钮（录音）
  - ⚪ 灰色按钮（结束对话）
- ✅ 显示"点击绿色按钮开始录音"

### 第 3 步：测试手动录音

**操作**：
1. 点击绿色按钮
2. 说 "Hello, how are you?"
3. 点击红色按钮（按钮会变红）

**预期结果**：
- ✅ 点击后按钮变红色
- ✅ 显示"🎤 正在录音..."
- ✅ 点击停止后显示"🔄 正在识别..."
- ✅ 控制台显示：
  ```
  [HybridSTT] Recording started
  [HybridSTT] Stopping recording...
  [HybridSTT] Audio recorded, size: XXXXX bytes
  [HybridSTT] Sending to Whisper API...
  [HybridSTT] Final transcription: Hello, how are you?
  ```
- ✅ AI 生成回复
- ✅ 显示"🗣️ 考拉正在说话..."
- ✅ TTS 播放声音

### 第 4 步：测试不会自动录音

**操作**：
1. 等待 AI 说完话
2. **不要点击任何按钮**
3. 保持安静 30 秒

**预期结果**：
- ✅ 不会自动开始录音
- ✅ 显示"点击绿色按钮开始录音"
- ✅ 控制台没有新的录音日志
- ✅ 需要手动点击绿色按钮才能继续

### 第 5 步：测试保持安静不会误触发

**操作**：
1. 点击"开始对话"
2. **不要点击录音按钮**
3. 保持安静 30 秒

**预期结果**：
- ✅ 不会自动开始录音
- ✅ 不会识别任何内容
- ✅ 不会触发 AI 回复
- ✅ 界面保持在"点击绿色按钮开始录音"

### 第 6 步：测试结束对话

**操作**：
- 点击灰色按钮

**预期结果**：
- ✅ 显示"对话已保存到历史记录！"
- ✅ 返回初始界面
- ✅ 历史记录中出现新的会话

## 🔍 控制台检查

### 打开控制台
1. 按 `F12` 或 `Cmd + Option + I`
2. 切换到 Console 标签

### 正常日志示例

**开始录音**：
```
[HybridSTT] Recording started (Browser STT + MediaRecorder)
[HybridSTT] Using MIME type: audio/webm;codecs=opus
```

**停止录音**：
```
[HybridSTT] Stopping recording...
[HybridSTT] MediaRecorder stopped
[HybridSTT] Audio recorded, size: 25000 bytes
[HybridSTT] Sending to Whisper API for transcription...
[HybridSTT] Final transcription: Hello, how are you?
```

**AI 回复**：
```
🔊 [OpenAI TTS] Generating speech: Hi! How are you today?
🔊 [OpenAI TTS] Voice: nova Model: tts-1-hd Speed: 0.9
🔊 [OpenAI TTS] Starting playback
🔊 [OpenAI TTS] Audio loaded, duration: 1.44 seconds
🔊 [OpenAI TTS] Speech ended
```

### 不应该出现的日志

❌ **自动录音**（如果出现说明有问题）：
```
[HybridSTT] Recording started
```
（在你没有点击按钮的情况下）

❌ **自动停止**（如果出现说明有问题）：
```
[HybridSTT] Auto-stop triggered
[HybridSTT] Silence/timeout detected
```

## ⚠️ 常见问题排查

### 问题 1：点击按钮没反应

**可能原因**：
- 浏览器缓存
- 麦克风权限

**解决方案**：
1. 强制刷新：`Cmd + Shift + R`
2. 检查麦克风权限：
   - Chrome: 地址栏左侧的锁图标 → 网站设置 → 麦克风 → 允许
3. 检查控制台是否有错误

### 问题 2：录音后没有识别结果

**可能原因**：
- 音频太短（< 15KB）
- Whisper API 问题
- 网络问题

**解决方案**：
1. 检查控制台日志：
   ```
   [HybridSTT] Audio recorded, size: XXXXX bytes
   ```
   如果 size < 15000，说明录音太短
2. 检查是否有 API 错误
3. 检查网络连接

### 问题 3：还是自动录音

**可能原因**：
- 浏览器缓存没清除

**解决方案**：
1. **强制刷新**：`Cmd + Shift + R`
2. 如果还不行，清除浏览器缓存：
   - Chrome: 设置 → 隐私和安全 → 清除浏览数据
   - 选择"缓存的图片和文件"
   - 时间范围：全部时间
3. 重启浏览器

### 问题 4：识别出错误的内容

**可能原因**：
- 环境噪音
- 麦克风录到系统音频

**解决方案**：
1. **使用耳机**（最佳方案）
2. 确保环境安静
3. 降低系统音量
4. 检查麦克风输入电平

## 📊 功能对比

### 修复前 ❌
```
开始对话 → 自动录音 → 识别噪音 → AI 回复 → 自动录音 → 无限循环
```

### 修复后 ✅
```
开始对话 → 等待 → 用户点击录音 → 用户点击停止 → AI 回复 → 等待 → 用户点击录音
```

## ✅ 检查完成标准

所有以下项目都应该是 ✅：

- [ ] 页面正常加载
- [ ] 可以开始会话
- [ ] 可以手动开始录音
- [ ] 可以手动停止录音
- [ ] Whisper 正常识别
- [ ] AI 正常回复
- [ ] TTS 正常播放
- [ ] AI 说完后不会自动录音
- [ ] 保持安静不会误触发
- [ ] 可以正常结束对话
- [ ] 对话保存到历史记录

## 🎯 快速测试流程

1. **强制刷新浏览器** (Cmd + Shift + R)
2. **点击"开始对话"**
3. **点击绿色按钮** → 说话 → **点击红色按钮**
4. **等待 AI 回复**
5. **观察是否自动录音**（应该不会）
6. **再次点击绿色按钮** → 继续对话
7. **点击灰色按钮** → 结束对话

## 📝 测试报告模板

如果发现问题，请提供以下信息：

```
### 问题描述
[描述具体问题]

### 重现步骤
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

### 预期结果
[应该发生什么]

### 实际结果
[实际发生了什么]

### 控制台日志
[粘贴控制台日志]

### 截图
[如果可能，提供截图]
```

---

**检查时间**：2026-01-10  
**版本**：手动控制模式  
**重要**：必须强制刷新浏览器！
